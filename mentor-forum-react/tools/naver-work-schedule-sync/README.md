# Naver Work Schedule Sync Extension (MV3)

네이버 카페의 근무일정 게시글을 `work_schedule` 게시판으로 주기 동기화하는 크롬 확장프로그램입니다.

## 동작 방식

1. 확장프로그램이 15분마다 tick 알람으로 실행됩니다.
2. `Asia/Seoul` 기준 설정 시각(`0,6,12,18`)의 00~09분 사이에 1회 동기화를 수행합니다.
3. 기본은 네이버 메뉴 페이지에서 최신 게시글 링크를 수집합니다.
   - 옵션의 `대상 게시글 링크`를 입력하면 메뉴 탐색 대신 해당 링크만 수집합니다.
4. 각 게시글의 제목/수정일/본문을 읽어 Firestore `posts` 컬렉션에 upsert 합니다.
   - 문서 ID: `naver_cafe_{cafeId}_{articleId}`
   - 게시판: `work_schedule`
   - 동일 제목(`title`)의 기존 글이 있으면 해당 글 문서에 덮어씁니다.
   - 동일 콘텐츠라도 운영 기준상 **항상 덮어쓰기(강제 upsert)** 합니다.
   - 현재 스킵은 주로 게시글 식별 실패(`articleId` 미검출) 케이스에 해당합니다.
5. 본문 표에서 `날짜/요일/풀타임/파트1/파트2/파트3`를 파싱해 `workScheduleRows`로 저장합니다.
6. 확장프로그램은 `근무일정 데이터 동기화`만 수행합니다.
   - 근무일정 모바일 푸시 스케줄/발송은 기존 서버 파이프라인(GAS/서버 배치)에서 담당합니다.

## 설치

1. 크롬 주소창에서 `chrome://extensions` 진입
2. 우측 상단 `개발자 모드` ON
3. `압축해제된 확장 프로그램을 로드` 클릭
4. 이 폴더(`tools/naver-work-schedule-sync`) 선택

## 최초 설정

1. 확장 프로그램 아이콘 클릭 -> `설정 열기`
2. Firebase API Key / Project ID 확인
   - 기본값은 현재 프로젝트(`guro-mentor-forum`)로 채워져 있습니다.
3. Firebase 로그인 연결
   - 쓰기 권한이 있는 계정(`Super_Admin`, `Admin`, `Staff`)으로 로그인 필요
4. 네이버 메뉴 URL 입력
5. 스케줄 시각 확인 (`0,6,12,18`)
6. `지금 동기화 실행`으로 동작 검증

## 권장 계정 운영

- 개인 계정 대신 전용 서비스 계정을 하나 만들어 사용하세요.
- 확장프로그램에는 비밀번호를 저장하지 않고 refresh token만 저장합니다.
- 네이버 로그인 세션이 끊기면 수집이 실패하므로, 네이버 카페 로그인 상태를 유지해야 합니다.

## 제한 사항

- 네이버 카페 DOM 구조가 크게 바뀌면 셀렉터 보정이 필요합니다.
- 크롬이 꺼져 있거나 PC가 절전이면 해당 시각 작업은 건너뛸 수 있습니다.
- 보안 정책/로그인 상태에 따라 일부 게시글은 추출되지 않을 수 있습니다.
